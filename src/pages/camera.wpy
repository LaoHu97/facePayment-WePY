<template>
<view class="camera_view">
  <view class="text">请保持微笑完成拍照😊</view>
  <camera class="camera" device-position="front" flash="auto" binderror="error">
    <cover-view>
      <cover-image class="img" src="../images/humanface.png" />
    </cover-view>
  </camera>
  <view class="btn-area">
    <button type="primary" bindtap="takePhoto">拍照上传</button>
  </view>
</view>
</template>

<script>
import wepy from 'wepy'
import Foot from '../components/foot'
export default class Camera extends wepy.page {
  config = {
    navigationBarTitleText: '拍照认证'
  }
  components = {
    foot: Foot
  }

  data = {

  }
  methods = {
    takePhoto() {
      let _this = this
      wepy.showLoading({
        title: '加载中',
        mask: true
      })
      const ctx = wepy.createCameraContext()
      ctx.takePhoto({
        quality: 'low',
        success: (res) => {
          _this.uploadFile(res.tempImagePath)
          wepy.hideLoading()
        }
      })
    },
    error(e) {
      console.log(e.detail)
    }
  }
  uploadFile(data) {
    console.log(data)
    console.log('正在上传图片')
    wepy.showLoading({
      title: '正在上传',
      mask: true
    })
    wepy.uploadFile({
      url: 'http://test.weupay.com/pay/api/face/addFacePerson',
      filePath: data,
      name: 'imageUrl',
      formData: {
        'person_name': 'liuyifei',
        'phone': '12345678'
      },
      success: function(res) {
        console.log(res)
        console.log('图片上传完成')
        wepy.navigateTo({
          url: 'accomplish'
        })
        wepy.hideLoading()
      },
      fail: function(res) {
        wepy.hideLoading()
        console.log('图片上传失败')
      }
    })
  }
  events = {}
  onShow() {}
}
</script>

<style lang="less">
.camera_view {
    height: 100%;
    .camera {
        position: fixed;
        bottom: 46px;
        width: 100%;
        height: 1000rpx;
    }
    .text {
        color: #3897d3;
        font-size: 48rpx;
        text-align: center;
        line-height: 1.5;
        margin-top: 50rpx;
    }
}
.btn-area {
    width: 100%;
    position: fixed;
    bottom: 0;
}
.img {
    width: 100%;
    height: 100%;
}
</style>
